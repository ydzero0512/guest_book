<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ë°©ëª…ë¡</title>
    <style>
      @font-face {
        font-family: "RixMomsBlanketR";
        src: url("https://fastly.jsdelivr.net/gh/projectnoonnu/noonfonts_2302@1.0/RixMomsBlanketR.woff2")
          format("woff2");
        font-weight: normal;
        font-style: normal;
      }

      body {
        font-family: "RixMomsBlanketR";
        margin: 20px;
        background-color: #f9f9f9;
      }
      .container {
        max-width: 600px;
        margin: 0 auto;
        background: white;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 4px 6px rgba(220, 219, 219, 0.1);
      }
      textarea {
        width: 95%;
        height: 80px;
        margin-bottom: 10px;
        padding: 10px;
        font-size: 16px;
        border: 1px solid #ddd;
        border-radius: 4px;
        resize: none;
      }
      button {
        display: block;
        width: 100%;
        padding: 10px 20px;
        font-size: 16px;
        cursor: pointer;
        background-color: #00a1b9;
        color: white;
        border: none;
        border-radius: 4px;
        transition: background-color 0.3s;
      }
      button:hover {
        background-color: #008ba1;
      }
      ul {
        list-style: none;
        padding: 0;
        margin-top: 20px;
      }
      li {
        display: flex;
        align-items: center;
        padding: 10px;
        margin-bottom: 10px;
        background-color: #f2f4f4;
        border: 1px solid #ddd;
        border-radius: 4px;
        word-wrap: break-word;
      }
      .profile {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        overflow: hidden;
        margin-right: 10px;
        border: 1px solid #ddd;
      }
      .profile img {
        width: 100%;
        height: 100%;
        object-fit: cover;
      }
      .text {
        flex: 1;
      }

      /* ë°˜ì‘í˜• ë””ìì¸ */
      @media (max-width: 768px) {
        body {
          margin: 10px;
        }
        .container {
          padding: 15px;
        }
        textarea {
          font-size: 14px;
        }
        button {
          font-size: 14px;
        }
        li {
          font-size: 14px;
        }
      }

      @media (max-width: 480px) {
        textarea {
          height: 60px;
        }
        button {
          padding: 8px;
        }
        li {
          font-size: 12px;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>ğŸ€</h1>
      <h2>ë°©ëª…ë¡ì„ ë‚¨ê²¨ì£¼ì„¸ìš”..</h2>
      <!-- ë°©ëª…ë¡ ì…ë ¥ì¹¸ -->
      <textarea id="guestInput" placeholder="ëŒ“ê¸€ì„ ì¨ì£¼ì„¸ìš”.."></textarea>
      <button id="addButton">ì¶”ê°€</button>
      <hr />
      <!-- ë°©ëª…ë¡ ë¦¬ìŠ¤íŠ¸ -->
      <ul id="guestList"></ul>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script>
      const input = document.getElementById("guestInput");
      const list = document.getElementById("guestList");
      const addButton = document.getElementById("addButton");

      let isEnterPressed = false; // ì—”í„°í‚¤ ì¤‘ë³µ ë°©ì§€ í”Œë˜ê·¸

      // ì…ë ¥ ì²˜ë¦¬ ì´ë²¤íŠ¸ (Enter í‚¤ë¡œë§Œ ì²˜ë¦¬)
      input.addEventListener("keydown", function (event) {
        if (event.key === "Enter" && !event.shiftKey) {
          event.preventDefault(); // Enter í‚¤ë¡œ ì¤„ë°”ê¿ˆ ë°©ì§€

          if (!isEnterPressed) {
            // ì¤‘ë³µ í˜¸ì¶œ ë°©ì§€
            isEnterPressed = true;
            addGuestEntry(); // ë°©ëª…ë¡ ì¶”ê°€

            // ì ì‹œ í›„ í”Œë˜ê·¸ ë¦¬ì…‹ (0.1ì´ˆ í›„)
            setTimeout(() => {
              isEnterPressed = false;
            }, 100);
          }
        }
      });

      // ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸
      addButton.addEventListener("click", function () {
        addGuestEntry(); // ë°©ëª…ë¡ ì¶”ê°€
      });

      // ë°©ëª…ë¡ ì¶”ê°€ í•¨ìˆ˜
      async function addGuestEntry() {
        let text = input.value.trim(); // ê³µë°± ì œê±°

        if (!text) {
          alert("ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”!");
          return;
        }

        // ì¤„ë°”ê¿ˆì„ ê³µë°±ìœ¼ë¡œ ë³€í™˜ (ì—¬ëŸ¬ ì¤„ì„ ì…ë ¥í•œ ê²½ìš°)
        text = text.replace(/\n/g, " ");
        try {
          const response = await axios.post("/guest/write", {
            text: text, // JSON í˜•ì‹ì˜ ë°ì´í„° ì „ì†¡
          });

          // ìƒˆ ê¸€ì„ ë¦¬ìŠ¤íŠ¸ ë§¨ ì•ì— ì¶”ê°€
          const newEntry = response.data; // ì„œë²„ì—ì„œ ìƒˆ ê¸€ ë°ì´í„°ë¥¼ ë°›ëŠ”ë‹¤ê³  ê°€ì •
          console.log(response);
          addNewEntryToList(newEntry);
        } catch (error) {
          console.error("ì„œë²„ ìš”ì²­ ì¤‘ ì—ëŸ¬ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤:", error);
        }
        input.value = ""; // ì…ë ¥ ì´ˆê¸°í™”
      }

      // ìƒˆ ë°©ëª…ë¡ í•­ëª©ì„ ë¦¬ìŠ¤íŠ¸ì˜ ë§¨ ì•ì— ì¶”ê°€í•˜ëŠ” í•¨ìˆ˜
      function addNewEntryToList(entry) {
        const listItem = document.createElement("li");
        listItem.innerHTML = `
          <div class="profile">
            <img src="https://cdn-icons-png.flaticon.com/128/621/621699.png" alt="Profile Picture">
          </div>
          <div class="text">${entry.text}</div>
          <div class="date">${entry.date}</div>
        `;
        list.insertBefore(listItem, list.firstChild); // ë§¨ ì•ì— ì¶”ê°€
      }

      // í˜ì´ì§€ ë¡œë“œ ì‹œ ë°©ëª…ë¡ ëª©ë¡ ê°€ì ¸ì˜¤ê¸°
      window.onload = async function () {
        try {
          const response = await axios.get("/guest/list");
          const guestEntries = response.data;

          // ê°€ì ¸ì˜¨ ë°©ëª…ë¡ì„ ë¦¬ìŠ¤íŠ¸ì— ì¶”ê°€
          guestEntries.forEach((entry) => {
            addNewEntryToList(entry);
          });
        } catch (error) {
          console.error(
            "ë°©ëª…ë¡ ëª©ë¡ì„ ê°€ì ¸ì˜¤ëŠ” ì¤‘ ì—ëŸ¬ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤:",
            error
          );
        }
      };
    </script>
  </body>
</html>
